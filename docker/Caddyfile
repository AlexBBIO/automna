# Automna Reverse Proxy Configuration
# Routes all traffic through single port with internal services

:18789 {
    # Large file uploads (100MB max)
    request_body {
        max_size 100MB
    }

    # CORS headers for dashboard (automna.ai) accessing the gateway
    @cors_preflight method OPTIONS
    handle @cors_preflight {
        header Access-Control-Allow-Origin "https://automna.ai"
        header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        header Access-Control-Allow-Headers "Content-Type, Authorization"
        header Access-Control-Allow-Credentials "true"
        header Access-Control-Max-Age "86400"
        respond 204
    }

    header Access-Control-Allow-Origin "https://automna.ai"
    header Access-Control-Allow-Credentials "true"

    # File server routes - strip /files prefix before forwarding
    handle_path /files/* {
        reverse_proxy localhost:8080
    }

    # Everything else goes to OpenClaw gateway
    handle {
        reverse_proxy localhost:18788
    }

    # Logging
    log {
        output stdout
        format console
        level WARN
    }
}
